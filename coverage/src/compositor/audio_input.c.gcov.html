<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">

<html lang="en">

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>LCOV - coverage.info - src/compositor/audio_input.c</title>
  <link rel="stylesheet" type="text/css" href="../../gcov.css">
</head>

<body>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="title">LCOV - code coverage report</td></tr>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>

    <tr>
      <td width="100%">
        <table cellpadding=1 border=0 width="100%">
          <tr>
            <td width="10%" class="headerItem">Current view:</td>
            <td width="35%" class="headerValue"><a href="../../index.html">top level</a> - <a href="index.html">src/compositor</a> - audio_input.c<span style="font-size: 80%;"> (source / <a href="audio_input.c.func-sort-c.html">functions</a>)</span></td>
            <td width="5%"></td>
            <td width="15%"></td>
            <td width="10%" class="headerCovTableHead">Hit</td>
            <td width="10%" class="headerCovTableHead">Total</td>
            <td width="15%" class="headerCovTableHead">Coverage</td>
          </tr>
          <tr>
            <td class="headerItem">Test:</td>
            <td class="headerValue">coverage.info</td>
            <td></td>
            <td class="headerItem">Lines:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">218</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr>
            <td class="headerItem">Date:</td>
            <td class="headerValue">2016-06-07 10:36:32</td>
            <td></td>
            <td class="headerItem">Functions:</td>
            <td class="headerCovTableEntry">0</td>
            <td class="headerCovTableEntry">23</td>
            <td class="headerCovTableEntryLo">0.0 %</td>
          </tr>
          <tr><td><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
        </table>
      </td>
    </tr>

    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
  </table>

  <table cellpadding=0 cellspacing=0 border=0>
    <tr>
      <td><br></td>
    </tr>
    <tr>
      <td>
<pre class="sourceHeading">          Line data    Source code</pre>
<pre class="source">
<a name="1"><span class="lineNum">       1 </span>            : /*</a>
<span class="lineNum">       2 </span>            :  *                      GPAC - Multimedia Framework C SDK
<span class="lineNum">       3 </span>            :  *
<span class="lineNum">       4 </span>            :  *                      Authors: Jean Le Feuvre
<span class="lineNum">       5 </span>            :  *                      Copyright (c) Telecom ParisTech 2000-2012
<span class="lineNum">       6 </span>            :  *                                      All rights reserved
<span class="lineNum">       7 </span>            :  *
<span class="lineNum">       8 </span>            :  *  This file is part of GPAC / Scene Compositor sub-project
<span class="lineNum">       9 </span>            :  *
<span class="lineNum">      10 </span>            :  *  GPAC is free software; you can redistribute it and/or modify
<span class="lineNum">      11 </span>            :  *  it under the terms of the GNU Lesser General Public License as published by
<span class="lineNum">      12 </span>            :  *  the Free Software Foundation; either version 2, or (at your option)
<span class="lineNum">      13 </span>            :  *  any later version.
<span class="lineNum">      14 </span>            :  *
<span class="lineNum">      15 </span>            :  *  GPAC is distributed in the hope that it will be useful,
<span class="lineNum">      16 </span>            :  *  but WITHOUT ANY WARRANTY; without even the implied warranty of
<span class="lineNum">      17 </span>            :  *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
<span class="lineNum">      18 </span>            :  *  GNU Lesser General Public License for more details.
<span class="lineNum">      19 </span>            :  *
<span class="lineNum">      20 </span>            :  *  You should have received a copy of the GNU Lesser General Public
<span class="lineNum">      21 </span>            :  *  License along with this library; see the file COPYING.  If not, write to
<span class="lineNum">      22 </span>            :  *  the Free Software Foundation, 675 Mass Ave, Cambridge, MA 02139, USA.
<span class="lineNum">      23 </span>            :  *
<span class="lineNum">      24 </span>            :  */
<span class="lineNum">      25 </span>            : 
<span class="lineNum">      26 </span>            : #include &lt;gpac/internal/compositor_dev.h&gt;
<span class="lineNum">      27 </span>            : 
<span class="lineNum">      28 </span>            : #define ENABLE_EARLY_FRAME_DETECTION
<span class="lineNum">      29 </span>            : 
<span class="lineNum">      30 </span>            : /*diff time in ms to consider an audio frame too late and drop it - we should try to dynamically figure this out
<span class="lineNum">      31 </span>            : since the drift may be high on TS for example, where PTS-PCR&gt;500ms is quite common*/
<span class="lineNum">      32 </span>            : #define MAX_RESYNC_TIME         1000
<span class="lineNum">      33 </span>            : //if drift between audio object time and clock varies more is than this value (in ms) between two drift computation, clock is adjusted. We don't adjust for lower values otherwise we would
<span class="lineNum">      34 </span>            : //introduce oscillations in the clock and non-smooth playback
<span class="lineNum">      35 </span>            : #define MIN_DRIFT_ADJUST        75
<span class="lineNum">      36 </span>            : 
<span class="lineNum">      37 </span>            : struct __audiofilteritem
<span class="lineNum">      38 </span>            : {
<span class="lineNum">      39 </span>            :         GF_AudioInterface input;
<span class="lineNum">      40 </span>            :         GF_AudioInterface *src;
<span class="lineNum">      41 </span>            : 
<span class="lineNum">      42 </span>            :         u32 out_chan, out_ch_cfg;
<span class="lineNum">      43 </span>            : 
<span class="lineNum">      44 </span>            :         u32 nb_used, nb_filled;
<span class="lineNum">      45 </span>            : 
<span class="lineNum">      46 </span>            :         GF_AudioFilterChain filter_chain;
<span class="lineNum">      47 </span>            : };
<span class="lineNum">      48 </span>            : 
<span class="lineNum">      49 </span>            : 
<span class="lineNum">      50 </span>            : GF_AudioFilterItem *gf_af_new(GF_Compositor *compositor, GF_AudioInterface *src, char *filter_name);
<span class="lineNum">      51 </span>            : void gf_af_del(GF_AudioFilterItem *af);
<span class="lineNum">      52 </span>            : void gf_af_reset(GF_AudioFilterItem *af);
<a name="53"><span class="lineNum">      53 </span>            : </a>
<span class="lineNum">      54 </span>            : 
<span class="lineNum">      55 </span>            : static char *gf_audio_input_fetch_frame(void *callback, u32 *size, u32 audio_delay_ms)
<span class="lineNum">      56 </span>            : {
<span class="lineNum">      57 </span>            :         char *frame;
<span class="lineNum">      58 </span>            :         u32 obj_time, ts;
<span class="lineNum">      59 </span>            :         s32 drift;
<span class="lineNum">      60 </span>            :         Fixed speed;
<span class="lineNum">      61 </span>            :         Bool done;
<span class="lineNum">      62 </span><span class="lineNoCov">          0 :         GF_AudioInput *ai = (GF_AudioInput *) callback;</span>
<span class="lineNum">      63 </span>            :         /*even if the stream is signaled as finished we must check it, because it may have been restarted by a mediaControl*/
<span class="lineNum">      64 </span><span class="lineNoCov">          0 :         if (!ai-&gt;stream) return NULL;</span>
<span class="lineNum">      65 </span>            : 
<span class="lineNum">      66 </span><span class="lineNoCov">          0 :         done = ai-&gt;stream_finished;</span>
<span class="lineNum">      67 </span><span class="lineNoCov">          0 :         frame = gf_mo_fetch_data(ai-&gt;stream, ai-&gt;compositor-&gt;audio_renderer-&gt;step_mode ? GF_MO_FETCH_PAUSED : GF_MO_FETCH, &amp;ai-&gt;stream_finished, &amp;ts, size, NULL, NULL);</span>
<span class="lineNum">      68 </span>            :         /*invalidate scene on end of stream to refresh audio graph*/
<span class="lineNum">      69 </span><span class="lineNoCov">          0 :         if (done != ai-&gt;stream_finished) {</span>
<span class="lineNum">      70 </span><span class="lineNoCov">          0 :                 gf_sc_invalidate(ai-&gt;compositor, NULL);</span>
<span class="lineNum">      71 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">      72 </span>            : 
<span class="lineNum">      73 </span>            :         /*no more data or not enough data, reset syncro drift*/
<span class="lineNum">      74 </span><span class="lineNoCov">          0 :         if (!frame) {</span>
<span class="lineNum">      75 </span><span class="lineNoCov">          0 :                 if (!ai-&gt;stream_finished) {</span>
<span class="lineNum">      76 </span><span class="lineNoCov">          0 :                         GF_LOG(GF_LOG_INFO, GF_LOG_AUDIO, (&quot;[Audio Input] No data in audio object\n&quot;));</span>
<span class="lineNum">      77 </span>            :                 }
<span class="lineNum">      78 </span><span class="lineNoCov">          0 :                 gf_mo_adjust_clock(ai-&gt;stream, 0);</span>
<span class="lineNum">      79 </span><span class="lineNoCov">          0 :                 *size = 0;</span>
<span class="lineNum">      80 </span><span class="lineNoCov">          0 :                 return NULL;</span>
<span class="lineNum">      81 </span>            :         }
<span class="lineNum">      82 </span><span class="lineNoCov">          0 :         ai-&gt;need_release = GF_TRUE;</span>
<span class="lineNum">      83 </span>            : 
<span class="lineNum">      84 </span>            :         //step mode, return the frame without sync check
<span class="lineNum">      85 </span><span class="lineNoCov">          0 :         if (ai-&gt;compositor-&gt;audio_renderer-&gt;step_mode) {</span>
<span class="lineNum">      86 </span><span class="lineNoCov">          0 :                 GF_LOG(GF_LOG_DEBUG, GF_LOG_AUDIO, (&quot;[Audio Input] audio frame CTS %u %d bytes fetched\n&quot;, ts, *size));</span>
<span class="lineNum">      87 </span><span class="lineNoCov">          0 :                 return frame;</span>
<span class="lineNum">      88 </span>            :         }
<span class="lineNum">      89 </span>            : 
<span class="lineNum">      90 </span><span class="lineNoCov">          0 :         speed = gf_mo_get_current_speed(ai-&gt;stream);</span>
<span class="lineNum">      91 </span>            : 
<span class="lineNum">      92 </span><span class="lineNoCov">          0 :         gf_mo_get_object_time(ai-&gt;stream, &amp;obj_time);</span>
<span class="lineNum">      93 </span><span class="lineNoCov">          0 :         obj_time += audio_delay_ms;</span>
<span class="lineNum">      94 </span><span class="lineNoCov">          0 :         if (ai-&gt;compositor-&gt;bench_mode) {</span>
<span class="lineNum">      95 </span>            :                 drift = 0;
<span class="lineNum">      96 </span><span class="lineNoCov">          0 :         } else {</span>
<span class="lineNum">      97 </span>            :                 drift = (s32)obj_time;
<span class="lineNum">      98 </span><span class="lineNoCov">          0 :                 drift -= (s32)ts;</span>
<span class="lineNum">      99 </span>            :         }
<span class="lineNum">     100 </span>            : 
<span class="lineNum">     101 </span>            : #ifdef ENABLE_EARLY_FRAME_DETECTION
<span class="lineNum">     102 </span>            :         /*too early (silence insertions), skip*/
<span class="lineNum">     103 </span><span class="lineNoCov">          0 :         if (drift &lt; 0) {</span>
<span class="lineNum">     104 </span><span class="lineNoCov">          0 :                 GF_LOG(GF_LOG_INFO, GF_LOG_AUDIO, (&quot;[Audio Input] audio too early of %d (CTS %u at OTB %u with audio delay %d ms)\n&quot;, drift + audio_delay_ms, ts, obj_time, audio_delay_ms));</span>
<span class="lineNum">     105 </span><span class="lineNoCov">          0 :                 ai-&gt;need_release = GF_FALSE;</span>
<span class="lineNum">     106 </span><span class="lineNoCov">          0 :                 gf_mo_release_data(ai-&gt;stream, 0, -1);</span>
<span class="lineNum">     107 </span><span class="lineNoCov">          0 :                 *size = 0;</span>
<span class="lineNum">     108 </span><span class="lineNoCov">          0 :                 return NULL;</span>
<span class="lineNum">     109 </span>            :         }
<span class="lineNum">     110 </span>            : #endif
<span class="lineNum">     111 </span>            :         /*adjust drift*/
<span class="lineNum">     112 </span><span class="lineNoCov">          0 :         if (audio_delay_ms) {</span>
<span class="lineNum">     113 </span><span class="lineNoCov">          0 :                 s32 resync_delay = speed &gt; 0 ? FIX2INT(speed * MAX_RESYNC_TIME) : FIX2INT(-speed * MAX_RESYNC_TIME);</span>
<span class="lineNum">     114 </span>            :                 /*CU is way too late, discard and fetch a new one - this usually happen when media speed is more than 1*/
<span class="lineNum">     115 </span><span class="lineNoCov">          0 :                 if (drift&gt;resync_delay) {</span>
<span class="lineNum">     116 </span><span class="lineNoCov">          0 :                         GF_LOG(GF_LOG_INFO, GF_LOG_AUDIO, (&quot;[Audio Input] Audio data too late obj time %d - CTS %d - drift %d ms - resync forced\n&quot;, obj_time - audio_delay_ms, ts, drift));</span>
<span class="lineNum">     117 </span><span class="lineNoCov">          0 :                         gf_mo_release_data(ai-&gt;stream, *size, 2);</span>
<span class="lineNum">     118 </span><span class="lineNoCov">          0 :                         ai-&gt;need_release = GF_FALSE;</span>
<span class="lineNum">     119 </span><span class="lineNoCov">          0 :                         return gf_audio_input_fetch_frame(callback, size, audio_delay_ms);</span>
<span class="lineNum">     120 </span>            :                 }
<span class="lineNum">     121 </span><span class="lineNoCov">          0 :                 resync_delay = gf_mo_get_clock_drift(ai-&gt;stream) - drift;</span>
<span class="lineNum">     122 </span><span class="lineNoCov">          0 :                 if (resync_delay &lt; 0) resync_delay = -resync_delay;</span>
<span class="lineNum">     123 </span>            : 
<span class="lineNum">     124 </span><span class="lineNoCov">          0 :                 if (resync_delay &gt; MIN_DRIFT_ADJUST) {</span>
<span class="lineNum">     125 </span><span class="lineNoCov">          0 :                         GF_LOG(GF_LOG_DEBUG, GF_LOG_AUDIO, (&quot;[Audio Input] Audio clock: delay %d - obj time %d - audio delay %d - CTS %d - adjust drift %d\n&quot;, audio_delay_ms, obj_time, audio_delay_ms, ts, drift));</span>
<span class="lineNum">     126 </span><span class="lineNoCov">          0 :                         gf_mo_adjust_clock(ai-&gt;stream, drift);</span>
<span class="lineNum">     127 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">     128 </span>            :         }
<span class="lineNum">     129 </span><span class="lineNoCov">          0 :         return frame;</span>
<a name="130"><span class="lineNum">     130 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     131 </span>            : 
<span class="lineNum">     132 </span>            : static void gf_audio_input_release_frame(void *callback, u32 nb_bytes)
<span class="lineNum">     133 </span>            : {
<span class="lineNum">     134 </span><span class="lineNoCov">          0 :         GF_AudioInput *ai = (GF_AudioInput *) callback;</span>
<span class="lineNum">     135 </span><span class="lineNoCov">          0 :         if (!ai-&gt;stream) return;</span>
<span class="lineNum">     136 </span><span class="lineNoCov">          0 :         gf_mo_release_data(ai-&gt;stream, nb_bytes, 1);</span>
<span class="lineNum">     137 </span><span class="lineNoCov">          0 :         ai-&gt;need_release = GF_FALSE;</span>
<a name="138"><span class="lineNum">     138 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     139 </span>            : 
<span class="lineNum">     140 </span>            : static Fixed gf_audio_input_get_speed(void *callback)
<span class="lineNum">     141 </span>            : {
<span class="lineNum">     142 </span><span class="lineNoCov">          0 :         GF_AudioInput *ai = (GF_AudioInput *) callback;</span>
<span class="lineNum">     143 </span><span class="lineNoCov">          0 :         return gf_mo_get_current_speed(ai-&gt;stream);</span>
<a name="144"><span class="lineNum">     144 </span>            : }</a>
<span class="lineNum">     145 </span>            : 
<span class="lineNum">     146 </span>            : static Bool gf_audio_input_get_volume(void *callback, Fixed *vol)
<span class="lineNum">     147 </span>            : {
<span class="lineNum">     148 </span><span class="lineNoCov">          0 :         GF_AudioInput *ai = (GF_AudioInput *) callback;</span>
<span class="lineNum">     149 </span><span class="lineNoCov">          0 :         if (ai-&gt;snd &amp;&amp; ai-&gt;snd-&gt;GetChannelVolume) {</span>
<span class="lineNum">     150 </span><span class="lineNoCov">          0 :                 return ai-&gt;snd-&gt;GetChannelVolume(ai-&gt;snd-&gt;owner, vol);</span>
<span class="lineNum">     151 </span>            :         } else {
<span class="lineNum">     152 </span><span class="lineNoCov">          0 :                 vol[0] = vol[1] = vol[2] = vol[3] = vol[4] = vol[5] = ai-&gt;intensity;</span>
<span class="lineNum">     153 </span><span class="lineNoCov">          0 :                 return (ai-&gt;intensity==FIX_ONE) ? GF_FALSE : GF_TRUE;</span>
<span class="lineNum">     154 </span>            :         }
<a name="155"><span class="lineNum">     155 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     156 </span>            : 
<span class="lineNum">     157 </span>            : static Bool gf_audio_input_is_muted(void *callback)
<span class="lineNum">     158 </span>            : {
<span class="lineNum">     159 </span><span class="lineNoCov">          0 :         GF_AudioInput *ai = (GF_AudioInput *) callback;</span>
<span class="lineNum">     160 </span><span class="lineNoCov">          0 :         if (!ai-&gt;stream) return GF_TRUE;</span>
<span class="lineNum">     161 </span><span class="lineNoCov">          0 :         if (ai-&gt;is_muted)</span>
<span class="lineNum">     162 </span><span class="lineNoCov">          0 :                 return GF_TRUE;</span>
<span class="lineNum">     163 </span><span class="lineNoCov">          0 :         return gf_mo_is_muted(ai-&gt;stream);</span>
<a name="164"><span class="lineNum">     164 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     165 </span>            : 
<span class="lineNum">     166 </span>            : static Bool gf_audio_input_get_config(GF_AudioInterface *aifc, Bool for_recf)
<span class="lineNum">     167 </span>            : {
<span class="lineNum">     168 </span><span class="lineNoCov">          0 :         GF_AudioInput *ai = (GF_AudioInput *) aifc-&gt;callback;</span>
<span class="lineNum">     169 </span><span class="lineNoCov">          0 :         if (!ai-&gt;stream) return GF_FALSE;</span>
<span class="lineNum">     170 </span>            :         /*watchout for object reuse*/
<span class="lineNum">     171 </span><span class="lineNoCov">          0 :         if (aifc-&gt;samplerate &amp;&amp; (gf_mo_get_flags(ai-&gt;stream) &amp; GF_MO_IS_INIT)) return GF_TRUE;</span>
<span class="lineNum">     172 </span>            : 
<span class="lineNum">     173 </span><span class="lineNoCov">          0 :         gf_mo_get_audio_info(ai-&gt;stream, &amp;aifc-&gt;samplerate, &amp;aifc-&gt;bps , &amp;aifc-&gt;chan, &amp;aifc-&gt;ch_cfg);</span>
<span class="lineNum">     174 </span>            : 
<span class="lineNum">     175 </span><span class="lineNoCov">          0 :         if (!for_recf)</span>
<span class="lineNum">     176 </span><span class="lineNoCov">          0 :                 return aifc-&gt;samplerate ? GF_TRUE : GF_FALSE;</span>
<span class="lineNum">     177 </span>            : 
<span class="lineNum">     178 </span><span class="lineNoCov">          0 :         if (aifc-&gt;samplerate * aifc-&gt;chan * aifc-&gt;bps &amp;&amp; ((aifc-&gt;chan&lt;=2) || aifc-&gt;ch_cfg))  {</span>
<span class="lineNum">     179 </span><span class="lineNoCov">          0 :                 gf_mo_set_flag(ai-&gt;stream, GF_MO_IS_INIT, GF_TRUE);</span>
<span class="lineNum">     180 </span><span class="lineNoCov">          0 :                 return GF_TRUE;</span>
<span class="lineNum">     181 </span>            :         }
<span class="lineNum">     182 </span><span class="lineNoCov">          0 :         gf_mo_set_flag(ai-&gt;stream, GF_MO_IS_INIT, GF_FALSE);</span>
<span class="lineNum">     183 </span><span class="lineNoCov">          0 :         return GF_FALSE;</span>
<span class="lineNum">     184 </span><span class="lineNoCov">          0 : }</span>
<a name="185"><span class="lineNum">     185 </span>            : </a>
<span class="lineNum">     186 </span>            : GF_EXPORT
<span class="lineNum">     187 </span>            : void gf_sc_audio_setup(GF_AudioInput *ai, GF_Compositor *compositor, GF_Node *node)
<span class="lineNum">     188 </span>            : {
<span class="lineNum">     189 </span><span class="lineNoCov">          0 :         memset(ai, 0, sizeof(GF_AudioInput));</span>
<span class="lineNum">     190 </span><span class="lineNoCov">          0 :         ai-&gt;owner = node;</span>
<span class="lineNum">     191 </span><span class="lineNoCov">          0 :         ai-&gt;compositor = compositor;</span>
<span class="lineNum">     192 </span><span class="lineNoCov">          0 :         ai-&gt;stream = NULL;</span>
<span class="lineNum">     193 </span>            :         /*setup io interface*/
<span class="lineNum">     194 </span><span class="lineNoCov">          0 :         ai-&gt;input_ifce.FetchFrame = gf_audio_input_fetch_frame;</span>
<span class="lineNum">     195 </span><span class="lineNoCov">          0 :         ai-&gt;input_ifce.ReleaseFrame = gf_audio_input_release_frame;</span>
<span class="lineNum">     196 </span><span class="lineNoCov">          0 :         ai-&gt;input_ifce.GetConfig = gf_audio_input_get_config;</span>
<span class="lineNum">     197 </span><span class="lineNoCov">          0 :         ai-&gt;input_ifce.GetChannelVolume = gf_audio_input_get_volume;</span>
<span class="lineNum">     198 </span><span class="lineNoCov">          0 :         ai-&gt;input_ifce.GetSpeed = gf_audio_input_get_speed;</span>
<span class="lineNum">     199 </span><span class="lineNoCov">          0 :         ai-&gt;input_ifce.IsMuted = gf_audio_input_is_muted;</span>
<span class="lineNum">     200 </span><span class="lineNoCov">          0 :         ai-&gt;input_ifce.callback = ai;</span>
<span class="lineNum">     201 </span><span class="lineNoCov">          0 :         ai-&gt;intensity = FIX_ONE;</span>
<span class="lineNum">     202 </span>            : 
<span class="lineNum">     203 </span><span class="lineNoCov">          0 :         ai-&gt;speed = FIX_ONE;</span>
<span class="lineNum">     204 </span>            : 
<a name="205"><span class="lineNum">     205 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     206 </span>            : 
<span class="lineNum">     207 </span>            : void gf_sc_audio_predestroy(GF_AudioInput *ai)
<span class="lineNum">     208 </span>            : {
<span class="lineNum">     209 </span><span class="lineNoCov">          0 :         gf_sc_audio_stop(ai);</span>
<span class="lineNum">     210 </span><span class="lineNoCov">          0 :         gf_sc_audio_unregister(ai);</span>
<span class="lineNum">     211 </span>            : 
<span class="lineNum">     212 </span><span class="lineNoCov">          0 :         if (ai-&gt;filter) gf_af_del(ai-&gt;filter);</span>
<span class="lineNum">     213 </span><span class="lineNoCov">          0 : }</span>
<a name="214"><span class="lineNum">     214 </span>            : </a>
<span class="lineNum">     215 </span>            : GF_EXPORT
<span class="lineNum">     216 </span>            : GF_Err gf_sc_audio_open(GF_AudioInput *ai, MFURL *url, Double clipBegin, Double clipEnd, Bool lock_timeline)
<span class="lineNum">     217 </span>            : {
<span class="lineNum">     218 </span>            :         u32 i;
<span class="lineNum">     219 </span><span class="lineNoCov">          0 :         if (ai-&gt;is_open) return GF_BAD_PARAM;</span>
<span class="lineNum">     220 </span>            : 
<span class="lineNum">     221 </span>            :         /*get media object*/
<span class="lineNum">     222 </span><span class="lineNoCov">          0 :         ai-&gt;stream = gf_mo_register(ai-&gt;owner, url, lock_timeline, GF_FALSE);</span>
<span class="lineNum">     223 </span>            :         /*bad URL*/
<span class="lineNum">     224 </span><span class="lineNoCov">          0 :         if (!ai-&gt;stream) return GF_NOT_SUPPORTED;</span>
<span class="lineNum">     225 </span>            : 
<span class="lineNum">     226 </span>            :         /*request play*/
<span class="lineNum">     227 </span><span class="lineNoCov">          0 :         gf_mo_play(ai-&gt;stream, clipBegin, clipEnd, GF_FALSE);</span>
<span class="lineNum">     228 </span>            : 
<span class="lineNum">     229 </span><span class="lineNoCov">          0 :         ai-&gt;stream_finished = GF_FALSE;</span>
<span class="lineNum">     230 </span><span class="lineNoCov">          0 :         ai-&gt;is_open = 1;</span>
<span class="lineNum">     231 </span><span class="lineNoCov">          0 :         gf_mo_set_flag(ai-&gt;stream, GF_MO_IS_INIT, GF_FALSE);</span>
<span class="lineNum">     232 </span>            : 
<span class="lineNum">     233 </span><span class="lineNoCov">          0 :         if (ai-&gt;filter) gf_af_del(ai-&gt;filter);</span>
<span class="lineNum">     234 </span><span class="lineNoCov">          0 :         ai-&gt;filter = NULL;</span>
<span class="lineNum">     235 </span>            : 
<span class="lineNum">     236 </span><span class="lineNoCov">          0 :         for (i=0; i&lt;url-&gt;count; i++) {</span>
<span class="lineNum">     237 </span><span class="lineNoCov">          0 :                 if (url-&gt;vals[i].url &amp;&amp; !strnicmp(url-&gt;vals[i].url, &quot;#filter=&quot;, 8)) {</span>
<span class="lineNum">     238 </span><span class="lineNoCov">          0 :                         ai-&gt;filter = gf_af_new(ai-&gt;compositor, &amp;ai-&gt;input_ifce, url-&gt;vals[i].url+8);</span>
<span class="lineNum">     239 </span><span class="lineNoCov">          0 :                         if (ai-&gt;filter)</span>
<span class="lineNum">     240 </span>            :                                 break;
<span class="lineNum">     241 </span>            :                 }
<span class="lineNum">     242 </span>            :         }
<span class="lineNum">     243 </span><span class="lineNoCov">          0 :         return GF_OK;</span>
<span class="lineNum">     244 </span><span class="lineNoCov">          0 : }</span>
<a name="245"><span class="lineNum">     245 </span>            : </a>
<span class="lineNum">     246 </span>            : GF_EXPORT
<span class="lineNum">     247 </span>            : void gf_sc_audio_stop(GF_AudioInput *ai)
<span class="lineNum">     248 </span>            : {
<span class="lineNum">     249 </span><span class="lineNoCov">          0 :         if (!ai-&gt;is_open) return;</span>
<span class="lineNum">     250 </span>            : 
<span class="lineNum">     251 </span>            :         /*we must make sure audio mixer is not using the stream otherwise we may leave it dirty (with unrelease frame)*/
<span class="lineNum">     252 </span><span class="lineNoCov">          0 :         gf_mixer_lock(ai-&gt;compositor-&gt;audio_renderer-&gt;mixer, GF_TRUE);</span>
<span class="lineNum">     253 </span>            : 
<span class="lineNum">     254 </span>            :         assert(!ai-&gt;need_release);
<span class="lineNum">     255 </span>            : 
<span class="lineNum">     256 </span><span class="lineNoCov">          0 :         gf_mo_stop(ai-&gt;stream);</span>
<span class="lineNum">     257 </span><span class="lineNoCov">          0 :         ai-&gt;is_open = 0;</span>
<span class="lineNum">     258 </span><span class="lineNoCov">          0 :         gf_mo_unregister(ai-&gt;owner, ai-&gt;stream);</span>
<span class="lineNum">     259 </span><span class="lineNoCov">          0 :         ai-&gt;stream = NULL;</span>
<span class="lineNum">     260 </span>            : 
<span class="lineNum">     261 </span><span class="lineNoCov">          0 :         if (ai-&gt;filter) gf_af_del(ai-&gt;filter);</span>
<span class="lineNum">     262 </span><span class="lineNoCov">          0 :         ai-&gt;filter = NULL;</span>
<span class="lineNum">     263 </span>            : 
<span class="lineNum">     264 </span><span class="lineNoCov">          0 :         gf_mixer_lock(ai-&gt;compositor-&gt;audio_renderer-&gt;mixer, GF_FALSE);</span>
<span class="lineNum">     265 </span>            : 
<span class="lineNum">     266 </span><span class="lineNoCov">          0 : }</span>
<a name="267"><span class="lineNum">     267 </span>            : </a>
<span class="lineNum">     268 </span>            : GF_EXPORT
<span class="lineNum">     269 </span>            : void gf_sc_audio_restart(GF_AudioInput *ai)
<span class="lineNum">     270 </span>            : {
<span class="lineNum">     271 </span><span class="lineNoCov">          0 :         if (!ai-&gt;is_open) return;</span>
<span class="lineNum">     272 </span><span class="lineNoCov">          0 :         if (ai-&gt;need_release) gf_mo_release_data(ai-&gt;stream, 0xFFFFFFFF, 2);</span>
<span class="lineNum">     273 </span><span class="lineNoCov">          0 :         ai-&gt;need_release = GF_FALSE;</span>
<span class="lineNum">     274 </span><span class="lineNoCov">          0 :         ai-&gt;stream_finished = GF_FALSE;</span>
<span class="lineNum">     275 </span><span class="lineNoCov">          0 :         if (ai-&gt;filter) gf_af_reset(ai-&gt;filter);</span>
<span class="lineNum">     276 </span><span class="lineNoCov">          0 :         gf_mo_restart(ai-&gt;stream);</span>
<span class="lineNum">     277 </span><span class="lineNoCov">          0 : }</span>
<a name="278"><span class="lineNum">     278 </span>            : </a>
<span class="lineNum">     279 </span>            : GF_EXPORT
<span class="lineNum">     280 </span>            : Bool gf_sc_audio_check_url(GF_AudioInput *ai, MFURL *url)
<span class="lineNum">     281 </span>            : {
<span class="lineNum">     282 </span><span class="lineNoCov">          0 :         if (!ai-&gt;stream) return url-&gt;count;</span>
<span class="lineNum">     283 </span><span class="lineNoCov">          0 :         return gf_mo_url_changed(ai-&gt;stream, url);</span>
<span class="lineNum">     284 </span><span class="lineNoCov">          0 : }</span>
<a name="285"><span class="lineNum">     285 </span>            : </a>
<span class="lineNum">     286 </span>            : GF_EXPORT
<span class="lineNum">     287 </span>            : void gf_sc_audio_register(GF_AudioInput *ai, GF_TraverseState *tr_state)
<span class="lineNum">     288 </span>            : {
<span class="lineNum">     289 </span>            :         GF_AudioInterface *aifce;
<span class="lineNum">     290 </span>            : 
<span class="lineNum">     291 </span>            :         /*check interface is valid*/
<span class="lineNum">     292 </span><span class="lineNoCov">          0 :         if (!ai-&gt;input_ifce.FetchFrame</span>
<span class="lineNum">     293 </span>            :                 || !ai-&gt;input_ifce.GetChannelVolume
<span class="lineNum">     294 </span>            :                 || !ai-&gt;input_ifce.GetConfig
<span class="lineNum">     295 </span>            :                 || !ai-&gt;input_ifce.GetSpeed
<span class="lineNum">     296 </span>            :                 || !ai-&gt;input_ifce.IsMuted
<span class="lineNum">     297 </span>            :                 || !ai-&gt;input_ifce.ReleaseFrame
<span class="lineNum">     298 </span>            :            ) return;
<span class="lineNum">     299 </span>            : 
<span class="lineNum">     300 </span>            :         aifce = &amp;ai-&gt;input_ifce;
<span class="lineNum">     301 </span><span class="lineNoCov">          0 :         if (ai-&gt;filter) aifce = &amp;ai-&gt;filter-&gt;input;</span>
<span class="lineNum">     302 </span>            : 
<span class="lineNum">     303 </span><span class="lineNoCov">          0 :         if (tr_state-&gt;audio_parent) {</span>
<span class="lineNum">     304 </span>            :                 /*this assume only one parent may use an audio node*/
<span class="lineNum">     305 </span><span class="lineNoCov">          0 :                 if (ai-&gt;register_with_parent) return;</span>
<span class="lineNum">     306 </span><span class="lineNoCov">          0 :                 if (ai-&gt;register_with_renderer) {</span>
<span class="lineNum">     307 </span><span class="lineNoCov">          0 :                         gf_sc_ar_remove_src(ai-&gt;compositor-&gt;audio_renderer, aifce);</span>
<span class="lineNum">     308 </span><span class="lineNoCov">          0 :                         ai-&gt;register_with_renderer = GF_FALSE;</span>
<span class="lineNum">     309 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">     310 </span><span class="lineNoCov">          0 :                 tr_state-&gt;audio_parent-&gt;add_source(tr_state-&gt;audio_parent, ai);</span>
<span class="lineNum">     311 </span><span class="lineNoCov">          0 :                 ai-&gt;register_with_parent = GF_TRUE;</span>
<span class="lineNum">     312 </span><span class="lineNoCov">          0 :                 ai-&gt;snd = tr_state-&gt;sound_holder;</span>
<span class="lineNum">     313 </span><span class="lineNoCov">          0 :         } else if (!ai-&gt;register_with_renderer) {</span>
<span class="lineNum">     314 </span>            : 
<span class="lineNum">     315 </span><span class="lineNoCov">          0 :                 if (ai-&gt;register_with_parent) {</span>
<span class="lineNum">     316 </span><span class="lineNoCov">          0 :                         ai-&gt;register_with_parent = GF_FALSE;</span>
<span class="lineNum">     317 </span>            :                         /*if used in a parent audio group, do a complete traverse to rebuild the group*/
<span class="lineNum">     318 </span><span class="lineNoCov">          0 :                         gf_sc_invalidate(ai-&gt;compositor, NULL);</span>
<span class="lineNum">     319 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">     320 </span>            : 
<span class="lineNum">     321 </span><span class="lineNoCov">          0 :                 gf_sc_ar_add_src(ai-&gt;compositor-&gt;audio_renderer, aifce);</span>
<span class="lineNum">     322 </span><span class="lineNoCov">          0 :                 ai-&gt;register_with_renderer = GF_TRUE;</span>
<span class="lineNum">     323 </span><span class="lineNoCov">          0 :                 ai-&gt;snd = tr_state-&gt;sound_holder;</span>
<span class="lineNum">     324 </span><span class="lineNoCov">          0 :         }</span>
<span class="lineNum">     325 </span><span class="lineNoCov">          0 : }</span>
<a name="326"><span class="lineNum">     326 </span>            : </a>
<span class="lineNum">     327 </span>            : GF_EXPORT
<span class="lineNum">     328 </span>            : void gf_sc_audio_unregister(GF_AudioInput *ai)
<span class="lineNum">     329 </span>            : {
<span class="lineNum">     330 </span><span class="lineNoCov">          0 :         GF_AudioInterface *aifce = &amp;ai-&gt;input_ifce;</span>
<span class="lineNum">     331 </span><span class="lineNoCov">          0 :         if (ai-&gt;filter) aifce = &amp;ai-&gt;filter-&gt;input;</span>
<span class="lineNum">     332 </span>            : 
<span class="lineNum">     333 </span><span class="lineNoCov">          0 :         if (ai-&gt;register_with_renderer) {</span>
<span class="lineNum">     334 </span><span class="lineNoCov">          0 :                 ai-&gt;register_with_renderer = GF_FALSE;</span>
<span class="lineNum">     335 </span><span class="lineNoCov">          0 :                 gf_sc_ar_remove_src(ai-&gt;compositor-&gt;audio_renderer, aifce);</span>
<span class="lineNum">     336 </span><span class="lineNoCov">          0 :         } else {</span>
<span class="lineNum">     337 </span>            :                 /*if used in a parent audio group, do a complete traverse to rebuild the group*/
<span class="lineNum">     338 </span><span class="lineNoCov">          0 :                 gf_sc_invalidate(ai-&gt;compositor, NULL);</span>
<span class="lineNum">     339 </span>            :         }
<span class="lineNum">     340 </span><span class="lineNoCov">          0 : }</span>
<a name="341"><span class="lineNum">     341 </span>            : </a>
<span class="lineNum">     342 </span>            : 
<span class="lineNum">     343 </span>            : static char *gf_af_fetch_frame(void *callback, u32 *size, u32 audio_delay_ms)
<span class="lineNum">     344 </span>            : {
<span class="lineNum">     345 </span><span class="lineNoCov">          0 :         GF_AudioFilterItem *af = (GF_AudioFilterItem *)callback;</span>
<span class="lineNum">     346 </span>            : 
<span class="lineNum">     347 </span><span class="lineNoCov">          0 :         *size = 0;</span>
<span class="lineNum">     348 </span><span class="lineNoCov">          0 :         if (!af-&gt;nb_used) {</span>
<span class="lineNum">     349 </span>            :                 /*force filling the filter chain output until no data is available, otherwise we may end up
<span class="lineNum">     350 </span>            :                 with data in input and no data as output because of block framing of the filter chain*/
<span class="lineNum">     351 </span><span class="lineNoCov">          0 :                 while (!af-&gt;nb_filled) {</span>
<span class="lineNum">     352 </span>            :                         u32 nb_bytes;
<span class="lineNum">     353 </span><span class="lineNoCov">          0 :                         char *data = af-&gt;src-&gt;FetchFrame(af-&gt;src-&gt;callback, &amp;nb_bytes, audio_delay_ms + af-&gt;filter_chain.delay_ms);</span>
<span class="lineNum">     354 </span>            :                         /*no input data*/
<span class="lineNum">     355 </span><span class="lineNoCov">          0 :                         if (!data || !nb_bytes)</span>
<span class="lineNum">     356 </span><span class="lineNoCov">          0 :                                 return NULL;</span>
<span class="lineNum">     357 </span>            : 
<span class="lineNum">     358 </span><span class="lineNoCov">          0 :                         if (nb_bytes &gt; af-&gt;filter_chain.min_block_size) nb_bytes = af-&gt;filter_chain.min_block_size;</span>
<span class="lineNum">     359 </span><span class="lineNoCov">          0 :                         memcpy(af-&gt;filter_chain.tmp_block1, data, nb_bytes);</span>
<span class="lineNum">     360 </span><span class="lineNoCov">          0 :                         af-&gt;src-&gt;ReleaseFrame(af-&gt;src-&gt;callback, nb_bytes);</span>
<span class="lineNum">     361 </span>            : 
<span class="lineNum">     362 </span><span class="lineNoCov">          0 :                         af-&gt;nb_filled = gf_afc_process(&amp;af-&gt;filter_chain, nb_bytes);</span>
<span class="lineNum">     363 </span><span class="lineNoCov">          0 :                 }</span>
<span class="lineNum">     364 </span>            :         }
<span class="lineNum">     365 </span>            : 
<span class="lineNum">     366 </span><span class="lineNoCov">          0 :         *size = af-&gt;nb_filled - af-&gt;nb_used;</span>
<a name="367"><span class="lineNum">     367 </span><span class="lineNoCov">          0 :         return af-&gt;filter_chain.tmp_block1 + af-&gt;nb_used;</span></a>
<span class="lineNum">     368 </span><span class="lineNoCov">          0 : }</span>
<span class="lineNum">     369 </span>            : static void gf_af_release_frame(void *callback, u32 nb_bytes)
<span class="lineNum">     370 </span>            : {
<span class="lineNum">     371 </span><span class="lineNoCov">          0 :         GF_AudioFilterItem *af = (GF_AudioFilterItem *)callback;</span>
<span class="lineNum">     372 </span>            :         /*mark used bytes of filter output*/
<span class="lineNum">     373 </span><span class="lineNoCov">          0 :         af-&gt;nb_used += nb_bytes;</span>
<span class="lineNum">     374 </span><span class="lineNoCov">          0 :         if (af-&gt;nb_used==af-&gt;nb_filled) {</span>
<span class="lineNum">     375 </span><span class="lineNoCov">          0 :                 af-&gt;nb_used = 0;</span>
<span class="lineNum">     376 </span><span class="lineNoCov">          0 :                 af-&gt;nb_filled = 0;</span>
<span class="lineNum">     377 </span><span class="lineNoCov">          0 :         }</span>
<a name="378"><span class="lineNum">     378 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     379 </span>            : 
<span class="lineNum">     380 </span>            : static Fixed gf_af_get_speed(void *callback)
<span class="lineNum">     381 </span>            : {
<span class="lineNum">     382 </span><span class="lineNoCov">          0 :         GF_AudioFilterItem *af = (GF_AudioFilterItem *)callback;</span>
<a name="383"><span class="lineNum">     383 </span><span class="lineNoCov">          0 :         return af-&gt;src-&gt;GetSpeed(af-&gt;src-&gt;callback);</span></a>
<span class="lineNum">     384 </span>            : }
<span class="lineNum">     385 </span>            : static Bool gf_af_get_channel_volume(void *callback, Fixed *vol)
<span class="lineNum">     386 </span>            : {
<span class="lineNum">     387 </span><span class="lineNoCov">          0 :         GF_AudioFilterItem *af = (GF_AudioFilterItem *)callback;</span>
<span class="lineNum">     388 </span><span class="lineNoCov">          0 :         return af-&gt;src-&gt;GetChannelVolume(af-&gt;src-&gt;callback, vol);</span>
<a name="389"><span class="lineNum">     389 </span>            : }</a>
<span class="lineNum">     390 </span>            : 
<span class="lineNum">     391 </span>            : static Bool gf_af_is_muted(void *callback)
<span class="lineNum">     392 </span>            : {
<span class="lineNum">     393 </span><span class="lineNoCov">          0 :         GF_AudioFilterItem *af = (GF_AudioFilterItem *)callback;</span>
<span class="lineNum">     394 </span><span class="lineNoCov">          0 :         return af-&gt;src-&gt;IsMuted(af-&gt;src-&gt;callback);</span>
<a name="395"><span class="lineNum">     395 </span>            : }</a>
<span class="lineNum">     396 </span>            : 
<span class="lineNum">     397 </span>            : static Bool gf_af_get_config(GF_AudioInterface *ai, Bool for_reconf)
<span class="lineNum">     398 </span>            : {
<span class="lineNum">     399 </span><span class="lineNoCov">          0 :         GF_AudioFilterItem *af = (GF_AudioFilterItem *)ai-&gt;callback;</span>
<span class="lineNum">     400 </span>            : 
<span class="lineNum">     401 </span><span class="lineNoCov">          0 :         Bool res = af-&gt;src-&gt;GetConfig(af-&gt;src, for_reconf);</span>
<span class="lineNum">     402 </span><span class="lineNoCov">          0 :         if (!res) return GF_FALSE;</span>
<span class="lineNum">     403 </span><span class="lineNoCov">          0 :         if (!for_reconf) return GF_TRUE;</span>
<span class="lineNum">     404 </span>            : 
<span class="lineNum">     405 </span>            : 
<span class="lineNum">     406 </span><span class="lineNoCov">          0 :         af-&gt;input.bps = af-&gt;src-&gt;bps;</span>
<span class="lineNum">     407 </span><span class="lineNoCov">          0 :         af-&gt;input.samplerate = af-&gt;src-&gt;samplerate;</span>
<span class="lineNum">     408 </span>            : 
<span class="lineNum">     409 </span><span class="lineNoCov">          0 :         af-&gt;input.ch_cfg = af-&gt;src-&gt;ch_cfg;</span>
<span class="lineNum">     410 </span><span class="lineNoCov">          0 :         af-&gt;input.chan = af-&gt;src-&gt;chan;</span>
<span class="lineNum">     411 </span>            : 
<span class="lineNum">     412 </span><span class="lineNoCov">          0 :         if (gf_afc_setup(&amp;af-&gt;filter_chain, af-&gt;input.bps, af-&gt;input.samplerate, af-&gt;src-&gt;chan, af-&gt;src-&gt;ch_cfg, &amp;af-&gt;input.chan, &amp;af-&gt;input.ch_cfg)!=GF_OK) {</span>
<span class="lineNum">     413 </span><span class="lineNoCov">          0 :                 GF_LOG(GF_LOG_ERROR, GF_LOG_AUDIO, (&quot;[Audio Input] Failed to configure audio filter chain\n&quot;));</span>
<span class="lineNum">     414 </span>            : 
<span class="lineNum">     415 </span><span class="lineNoCov">          0 :                 return GF_FALSE;</span>
<span class="lineNum">     416 </span>            :         }
<span class="lineNum">     417 </span><span class="lineNoCov">          0 :         return GF_TRUE;</span>
<a name="418"><span class="lineNum">     418 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     419 </span>            : 
<span class="lineNum">     420 </span>            : GF_AudioFilterItem *gf_af_new(GF_Compositor *compositor, GF_AudioInterface *src, char *filter_name)
<span class="lineNum">     421 </span>            : {
<span class="lineNum">     422 </span>            :         GF_AudioFilterItem *filter;
<span class="lineNum">     423 </span><span class="lineNoCov">          0 :         if (!src || !filter_name) return NULL;</span>
<span class="lineNum">     424 </span>            : 
<span class="lineNum">     425 </span><span class="lineNoCov">          0 :         GF_SAFEALLOC(filter, GF_AudioFilterItem);</span>
<span class="lineNum">     426 </span><span class="lineNoCov">          0 :         if (!filter) return NULL;</span>
<span class="lineNum">     427 </span>            :         
<span class="lineNum">     428 </span><span class="lineNoCov">          0 :         filter-&gt;src = src;</span>
<span class="lineNum">     429 </span><span class="lineNoCov">          0 :         filter-&gt;input.FetchFrame = gf_af_fetch_frame;</span>
<span class="lineNum">     430 </span><span class="lineNoCov">          0 :         filter-&gt;input.ReleaseFrame = gf_af_release_frame;</span>
<span class="lineNum">     431 </span><span class="lineNoCov">          0 :         filter-&gt;input.GetSpeed = gf_af_get_speed;</span>
<span class="lineNum">     432 </span><span class="lineNoCov">          0 :         filter-&gt;input.GetChannelVolume = gf_af_get_channel_volume;</span>
<span class="lineNum">     433 </span><span class="lineNoCov">          0 :         filter-&gt;input.IsMuted = gf_af_is_muted;</span>
<span class="lineNum">     434 </span><span class="lineNoCov">          0 :         filter-&gt;input.GetConfig = gf_af_get_config;</span>
<span class="lineNum">     435 </span><span class="lineNoCov">          0 :         filter-&gt;input.callback = filter;</span>
<span class="lineNum">     436 </span>            : 
<span class="lineNum">     437 </span><span class="lineNoCov">          0 :         gf_afc_load(&amp;filter-&gt;filter_chain, compositor-&gt;user, filter_name);</span>
<span class="lineNum">     438 </span><span class="lineNoCov">          0 :         return filter;</span>
<a name="439"><span class="lineNum">     439 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     440 </span>            : 
<span class="lineNum">     441 </span>            : void gf_af_del(GF_AudioFilterItem *af)
<span class="lineNum">     442 </span>            : {
<span class="lineNum">     443 </span><span class="lineNoCov">          0 :         gf_afc_unload(&amp;af-&gt;filter_chain);</span>
<span class="lineNum">     444 </span><span class="lineNoCov">          0 :         gf_free(af);</span>
<a name="445"><span class="lineNum">     445 </span><span class="lineNoCov">          0 : }</span></a>
<span class="lineNum">     446 </span>            : 
<span class="lineNum">     447 </span>            : void gf_af_reset(GF_AudioFilterItem *af)
<span class="lineNum">     448 </span>            : {
<span class="lineNum">     449 </span><span class="lineNoCov">          0 :         gf_afc_reset(&amp;af-&gt;filter_chain);</span>
<span class="lineNum">     450 </span>            : 
<span class="lineNum">     451 </span><span class="lineNoCov">          0 :         af-&gt;nb_filled = af-&gt;nb_used = 0;</span>
<span class="lineNum">     452 </span><span class="lineNoCov">          0 : }</span>
</pre>
      </td>
    </tr>
  </table>
  <br>

  <table width="100%" border=0 cellspacing=0 cellpadding=0>
    <tr><td class="ruler"><img src="../../glass.png" width=3 height=3 alt=""></td></tr>
    <tr><td class="versionInfo">Generated by: <a href="http://ltp.sourceforge.net/coverage/lcov.php" target="_parent">LCOV version 1.12</a></td></tr>
  </table>
  <br>

</body>
</html>
